name: rwx/install-captain
version: 1.1.3
description: Captain is an open source CLI that can detect and quarantine flaky tests, automatically retry failed tests, partition files for parallel execution, and more.
source_code_url: https://github.com/rwx-cloud/packages/tree/main/rwx/install-captain
issue_tracker_url: https://github.com/rwx-cloud/packages/issues

parameters:
  captain-version:
    description: "Version of the Captain CLI to install"
    default: "v2"

tasks:
  - key: install
    run: |
      tmpdir="$(mktemp -d)"
      curl -o "$tmpdir/captain" -fsSL "https://releases.captain.build/${CAPTAIN_VERSION}/linux/$(uname -p)/captain"
      sudo install "$tmpdir/captain" /usr/local/bin
      rm -rf "$tmpdir"
      captain --version
    cache:
      enabled: true
      ttl: 1 day
    env:
      CAPTAIN_VERSION: ${{ params.captain-version }}
