name: pagerduty/verify-signature
version: 1.0.0
description: Verify webhook signatures from PagerDuty
source_code_url: https://github.com/rwx-cloud/packages/tree/main/pagerduty/verify-signature
issue_tracker_url: https://github.com/rwx-cloud/packages/issues

parameters:
  body:
    description: "The body of the incoming webook"
    required: true
  headers:
    description: "The headers of the incoming webhook"
    required: true
  shared-secret:
    description: "The shared secret provided to you by PagerDuty upon creating the webhook"
    required: true

tasks:
  - key: python
    call: python/install 1.3.11
    with:
      python-version: 3.14.2

  - key: verify
    cache: false
    use: python
    run: |
      SIGNATURE=$(printf '%s' '${{ params.headers }}' | jq -r '.["x-pagerduty-signature"]')
      printf '%s' '${{ params.body }}' | python3 $RWX_PACKAGE_PATH/verify.py "${{ params.shared-secret }}" "$SIGNATURE" "v1"
